<!DOCTYPE html>
<html lang="en">
<head>
<style>

</style>

</head>

<body>

<canvas id="canvas" width="1200" height="600"></canvas>

<meta charset="utf-8">

<script src="util.js"></script>
<script src="bot.js"></script>
<script src="victor.min.js"></script>

<script>

var w = 1200, h = 600;
var fps, last_date, second = 0;
var canvas = document.getElementById('canvas');

var world = new World(w, h);
var bots = [];

Init();

function GetMousePos(canvas, evt) {
  var rect = canvas.getBoundingClientRect();
  return {
    x: evt.clientX - rect.left,
    y: evt.clientY - rect.top
  };
}

function Init() {
  for (var i = 0; i != 250; i++) {
    bots.push(new Bot(world));
  }

  canvas.addEventListener('mousemove', function(evt) {
    var mouse_pos = GetMousePos(canvas, evt);
    for (var i = 0; i != bots.length; i++) {
      bots[i].MouseHit(mouse_pos);
    }
  }, false);

  window.requestAnimationFrame(Draw);
}

function FpsLog() {
  if (!last_date) {
   last_date = Date.now();
   fps = 0;
   return;
  }
  dt = (new Date().getTime() - last_date)/1000;
  last_date = Date.now();
  fps = 1/dt;
  second += dt*1000;
  if (second > 1000) {
    second = 0;
    //console.log(fps);
    for (var i = 0; i != bots.length; i++) {
      //console.log(bots[i].pos);
    }
  }
  return dt;
}

function Draw() {
  var dt = FpsLog();

  var ctx = canvas.getContext('2d');

  ctx.clearRect(0, 0, w, h);
  ctx.fillStyle = "#111111";
  ctx.fillRect(0, 0, w, h);

  for (var i = 0; i < bots.length; i++) {
    ctx = bots[i].Draw(ctx);
    if (bots[i].Update(world, dt)) {
      bots.splice(i--, 1);
    }
  }
  
  ctx = world.Draw(ctx);
  world.Update(dt);
 
  window.requestAnimationFrame(Draw);
}

</script>

</body>

</html>