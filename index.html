<!DOCTYPE html>
<html lang="en">
<head>
<style>

</style>

</head>

<body>

<canvas id="canvas" width="400" height="600"></canvas>

<meta charset="utf-8">

<script src="util.js"></script>
<script src="bot.js"></script>
<script src="victor.min.js"></script>

<script>
var w = window.innerWidth*0.8, h = window.innerHeight*0.9, margin = 30, 
    gen_time = 10, second_count = 0;
var fps, saved_fps = 0, last_date, second = 0;
var canvas = document.getElementById('canvas');
canvas.setAttribute("width", w);
canvas.setAttribute("height", h);

var world = new World(w, h, margin);

var debug = true;

Init();

function GetMousePos(canvas, evt) {
  var rect = canvas.getBoundingClientRect();
  return {
    x: evt.clientX - rect.left,
    y: evt.clientY - rect.top
  };
}

function Init() {
  canvas.addEventListener('mousemove', function(evt) {
    var mouse_pos = GetMousePos(canvas, evt);
    world.MouseMove(mouse_pos);
  }, false);

  window.requestAnimationFrame(Draw);
}

function FpsLog() {
  if (!last_date) {
   last_date = Date.now();
   fps = 0;
   return;
  }
  dt = (new Date().getTime() - last_date)/1000;
  last_date = Date.now();
  fps = 1/dt;
  second += dt*1000;
  if (second > 1000) {
    saved_fps = fps;
    second = 0;
    second_count++;
    if (second_count % gen_time == 0) {
      world.NextGen();
    }
  }
  return dt;
}

function Draw() {
  var dt = FpsLog();

  var ctx = canvas.getContext('2d');

  ctx.clearRect(0, 0, w, h);
  ctx.fillStyle = "#222222";
  ctx.fillRect(0, 0, w, h);
  
  ctx = world.Draw(ctx);
  world.Update(dt);
  
  ctx.fillStyle = "#DDDDDD";
  ctx.font = "14px serif";
  ctx.fillText(saved_fps.toFixed(2), 10, 20);
 
  window.requestAnimationFrame(Draw);
}

</script>

</body>

</html>